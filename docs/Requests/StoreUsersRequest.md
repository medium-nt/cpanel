# StoreUsersRequest

## Назначение класса валидации

Класс `StoreUsersRequest` предназначен для валидации запросов на создание новых
пользователей в системе. Он проверяет корректность всех основных полей
пользователя, включая ФИО, email, телефон, пароль, роль и ставку заработной
платы.

## Правила авторизации (метод authorize)

```php
public function authorize(): bool
{
    return true;
}
```

- Все авторизованные пользователи имеют право выполнять данный запрос
- Дополнительные проверки авторизации не требуются

## Правила валидации (метод rules)

```php
public function rules(): array
{
    return [
        'name' => 'required|max:255',
        'email' => 'required|unique:users|max:255|email',
        'phone' => 'sometimes|string|min:8|max:50',
        'password' => 'required|confirmed|min:6|string',
        'role_id' => 'required|integer|exists:roles,id',
        'salary_rate' => 'required|numeric|min:0',
    ];
}
```

### Поля валидации:

- **`name`** - ФИО пользователя
    - `required` - Поле обязательно для заполнения
    - `max:255` - Максимальная длина - 255 символов

- **`email`** - Электронная почта пользователя
    - `required` - Поле обязательно для заполнения
    - `unique:users` - Email должен быть уникальным в таблице `users`
    - `max:255` - Максимальная длина - 255 символов
    - `email` - Значение должно быть валидным email адресом

- **`phone`** - Телефон пользователя
    - `sometimes` - Поле может отсутствовать в запросе
    - `string` - Должно быть строкой
    - `min:8` - Минимальная длина - 8 символов
    - `max:50` - Максимальная длина - 50 символов

- **`password`** - Пароль пользователя
    - `required` - Поле обязательно для заполнения
    - `confirmed` - Требуется подтверждение пароля (поле
      `password_confirmation`)
    - `min:6` - Минимальная длина - 6 символов
    - `string` - Должно быть строкой

- **`role_id`** - ID роли пользователя
    - `required` - Поле обязательно для заполнения
    - `integer` - Должно быть целым числом
    - `exists:roles,id` - Роль должна существовать в таблице `roles`

- **`salary_rate`** - Ставка заработной платы
    - `required` - Поле обязательно для заполнения
    - `numeric` - Должно быть числом
    - `min:0` - Минимальное значение - 0

## Кастомные сообщения об ошибках (метод messages)

```php
public function messages(): array
{
    return [
        'name.required' => 'Поле "ФИО" обязательно для заполнения',
        'name.min' => 'Поле "ФИО" должно быть не менее 2 символов',
        'name.max' => 'Поле "ФИО" должно быть не больше 255 символов',
        'email.required' => 'Поле "Email" обязательно для заполнения',
        'email.email' => 'Поле "Email" должно быть адресом электронной почты',
        'email.max' => 'Поле "Email" должно быть не больше 255 символов',
        'email.unique' => 'Сотрудник с таким Email уже зарегистрирован',
        'phone.string' => 'Поле "Телефон" должно быть строкой',
        'phone.min' => 'Поле "Телефон" должно быть не менее 8 символов',
        'phone.max' => 'Поле "Телефон" должно быть не больше 50 символов',
        'password.required' => 'Поле "Пароль" обязательно для заполнения',
        'password.confirmed' => 'Поля "Пароль" и "Подтверждение пароля" должны совпадать',
        'role_id.required' => 'Поле "Роль" обязательно для заполнения',
        'role_id.in' => 'Указана неизвестная роль для пользователя',
        'salary_rate.required' => 'Поле "Ставка" обязательно для заполнения',
        'salary_rate.numeric' => 'Поле "Ставка" должно быть числом',
        'salary_rate.min' => 'Поле "Ставка" должно быть не менее 0',
    ];
}
```

## Кастомные атрибуты (метод attributes)

В данном классе метод `attributes` не определен.

## Особенности валидации

1. **Подтверждение пароля** - Требуется наличие поля `password_confirmation` с
   тем же значением, что и у поля `password`
2. **Уникальность email** - Проверяется уникальность email в таблице
   пользователей
3. **Опциональный телефон** - Поле `phone` не является обязательным, но если
   указано, должно соответствовать формату
4. **Существование роли** - Проверяется, что указанная роль существует в системе
5. **Ограничения на длину** - Имя и email имеют ограничение в 255 символов, что
   соответствует стандартному лимиту для VARCHAR в MySQL

## Используемые в контроллерах

Данный Form Request используется в контроллере пользователей для создания новых
записей:

```php
// Пример использования в контроллере
public function store(StoreUsersRequest $request)
{
    $validated = $request->validated();
    // Хеширование пароля и создание нового пользователя
    $validated['password'] = bcrypt($validated['password']);
    User::create($validated);
}
```

Пример валидных данных:

```json
{
    "name": "Иванов Иван Иванович",
    "email": "ivanov@example.com",
    "phone": "+7(999)123-45-67",
    "password": "secret123",
    "password_confirmation": "secret123",
    "role_id": "2",
    "salary_rate": "15000"
}
```

Примечание: В правилах валидации для поля `name` указано правило `max:255`, но в
сообщениях об ошибках также упоминается правило `min:2`, которое не определено в
массиве правил. Вероятно, это ошибка в определении правил или сообщений.
