# MotivationUpdateUsersRequest

## Назначение класса валидации

Класс `MotivationUpdateUsersRequest` предназначен для валидации запросов на
обновление системы мотивации пользователей. Этот класс используется для
настройки бонусов и мотивационных схем для сотрудников с учетом различных типов
работ и диапазонов производства.

## Правила авторизации (метод authorize)

```php
public function authorize(): bool
{
    return true;
}
```

- Все авторизованные пользователи имеют право выполнять данный запрос
- Дополнительные проверки авторизации не требуются

## Правила валидации (метод rules)

```php
public function rules(): array
{
    return [
        'from' => 'array',
        'from.*' => 'nullable|numeric|min:0|max:1000',
        'to' => 'array',
        'to.*' => 'nullable|numeric|min:1|max:1000',
        'bonus' => 'array',
        'bonus.*' => 'nullable|numeric|min:0|max:1000',
        'not_cutter_bonus' => 'array',
        'not_cutter_bonus.*' => 'nullable|numeric|min:0|max:1000',
        'cutter_bonus' => 'array',
        'cutter_bonus.*' => 'nullable|numeric|min:0|max:1000',
    ];
}
```

### Поля валидации:

- **`from`** - Массив значений "От" для диапазонов
    - `array` - Должно быть массивом
    - `from.*` - Каждый элемент:
        - `nullable` - Может быть пустым (null)
        - `numeric` - Должно быть числом
        - `min:0` - Минимальное значение - 0
        - `max:1000` - Максимальное значение - 1000

- **`to`** - Массив значений "До" для диапазонов
    - `array` - Должно быть массивом
    - `to.*` - Каждый элемент:
        - `nullable` - Может быть пустым (null)
        - `numeric` - Должно быть числом
        - `min:1` - Минимальное значение - 1
        - `max:1000` - Максимальное значение - 1000

- **`bonus`** - Массив бонусов с закроем
    - `array` - Должно быть массивом
    - `bonus.*` - Каждый элемент:
        - `nullable` - Может быть пустым (null)
        - `numeric` - Должно быть числом
        - `min:0` - Минимальное значение - 0
        - `max:1000` - Максимальное значение - 1000

- **`not_cutter_bonus`** - Массив бонусов без кроя
    - `array` - Должно быть массивом
    - `not_cutter_bonus.*` - Каждый элемент:
        - `nullable` - Может быть пустым (null)
        - `numeric` - Должно быть числом
        - `min:0` - Минимальное значение - 0
        - `max:1000` - Максимальное значение - 1000

- **`cutter_bonus`** - Массив бонусов закройщика
    - `array` - Должно быть массивом
    - `cutter_bonus.*` - Каждый элемент:
        - `nullable` - Может быть пустым (null)
        - `numeric` - Должно быть числом
        - `min:0` - Минимальное значение - 0
        - `max:1000` - Максимальное значение - 1000

## Кастомные сообщения об ошибках (метод messages)

```php
public function messages(): array
{
    return [
        'from.array' => 'Ошибка в данных поля "От"',
        'from.*.numeric' => 'Должно быть указано число',
        'from.*.max' => 'Максимально возможное число для поля "От" - 1000',
        'from.*.min' => 'Меньше 0 указывать нельзя',

        'to.array' => 'Ошибка в данных поля "До"',
        'to.*.numeric' => 'Должно быть указано число',
        'to.*.max' => 'Максимально возможное число для поля "До" - 1000',
        'to.*.min' => 'Меньше 1 в поле "До" указывать нельзя',

        'bonus.array' => 'Ошибка в данных поля "бонус с закроем"',
        'bonus.*.numeric' => 'Должно быть указано число',
        'bonus.*.max' => 'Максимально возможное число для поля "бонус с закроем" - 1000',
        'bonus.*.min' => 'Меньше 0 указывать нельзя',

        'not_cutter_bonus.array' => 'Ошибка в данных поля "бонус без кроя"',
        'not_cutter_bonus.*.numeric' => 'Должно быть указано число',
        'not_cutter_bonus.*.max' => 'Максимально возможное число для поля "бонус без кроя" - 1000',
        'not_cutter_bonus.*.min' => 'Меньше 0 указывать нельзя',

        'cutter_bonus.array' => 'Ошибка в данных поля "бонус закройщика"',
        'cutter_bonus.*.numeric' => 'Должно быть указано число',
        'cutter_bonus.*.max' => 'Максимально возможное число для поля "бонус закройщика" - 1000',
        'cutter_bonus.*.min' => 'Меньше 0 указывать нельзя',
    ];
}
```

## Кастомные атрибуты (метод attributes)

В данном классе метод `attributes` не определен.

## Особенности валидации

1. **Дополнительная валидация** - Используется метод `withValidator` для сложной
   валидации последовательности:

```php
public function withValidator(Validator $validator): void
{
    $validator->after(function ($validator) {
        $to = $this->input('to', []);

        for ($i = 1; $i < count($to); $i++) {
            if ($to[$i] !== null && $to[$i - 1] !== null && $to[$i] <= $to[$i - 1]) {
                $validator->errors()
                    ->add("to.$i", 'значение "До" в строке ' . ($i + 1) . ' должно быть больше значения в строке ' . $i);
            }
        }
    });
}
```

2. **Диапазонная система мотивации** - Класс поддерживает систему мотивации на
   основе диапазонов значений "От" и "До"

3. **Типы бонусов** - Поддерживаются три типа бонусов:
    - `bonus` - бонус с закроем (для продукции требующей крой)
    - `not_cutter_bonus` - бонус без кроя (для продукции не требующей крой)
    - `cutter_bonus` - бонус закройщика (специальный бонус для закройщиков)

4. **Ограничения значений** - Все числовые значения ограничены диапазоном 0-1000

5. **Валидация последовательности** - Проверяется, что значения "До" идут в
   порядке возрастания (каждое следующее должно быть больше предыдущего)

6. **Nullable значения** - Все поля могут содержать null значения, что позволяет
   создавать неполные схемы мотивации

## Используемые в контроллерах

Данный Form Request используется в контроллере управления пользователями для
обновления мотивационных схем:

```php
// Пример использования в контроллере
public function updateMotivation(MotivationUpdateUsersRequest $request)
{
    $validated = $request->validated();

    // Сохранение мотивационной схемы
    foreach ($validated['from'] as $index => $from) {
        $motivation = new Motivation();
        $motivation->from = $from;
        $motivation->to = $validated['to'][$index] ?? null;
        $motivation->bonus = $validated['bonus'][$index] ?? null;
        $motivation->not_cutter_bonus = $validated['not_cutter_bonus'][$index] ?? null;
        $motivation->cutter_bonus = $validated['cutter_bonus'][$index] ?? null;
        $motivation->save();
    }
}
```

Пример валидных данных:

```json
{
    "from": ["0", "51", "101"],
    "to": ["50", "100", "999"],
    "bonus": ["100", "150", "200"],
    "not_cutter_bonus": ["80", "120", "160"],
    "cutter_bonus": ["50", "75", "100"]
}
```

## Контекст использования

Класс является ключевым для управления системой мотивации сотрудников, позволяя:

1. Создавать многоуровневые системы мотивации на основе объемов производства
2. Разделять бонусы для разных типов работ
3. Гибко настраивать мотивационные схемы для разных категорий сотрудников
4. Обеспечивать корректность последовательности диапазонов через дополнительную
   валидацию
