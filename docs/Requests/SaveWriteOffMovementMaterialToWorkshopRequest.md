# SaveWriteOffMovementMaterialToWorkshopRequest

## Назначение класса валидации

Класс `SaveWriteOffMovementMaterialToWorkshopRequest` предназначен для валидации
запросов на списание материалов в цехе. Этот класс используется при операциях
списания материалов из цеха с возможностью указания комментария.

## Правила авторизации (метод authorize)

```php
public function authorize(): bool
{
    return true;
}
```

- Все авторизованные пользователи имеют право выполнять данный запрос
- Дополнительные проверки авторизации не требуются

## Правила валидации (метод rules)

```php
public function rules(): array
{
    return [
        'comment' => 'string|min:2|max:255|nullable',
        'material_id.*.required' => 'Материал обязателен.',
        'material_id.*.exists:movement_materials,id' => 'Материал не найден.',
        'quantity.*.required' => 'Количество обязательно.',
        'quantity.*.min' => 'Количество должно быть больше или равно нулю.',
    ];
}
```

### Поля валидации:

- **`comment`** - Комментарий к списанию
    - `string` - Должно быть строкой
    - `min:2` - Минимальная длина - 2 символа
    - `max:255` - Максимальная длина - 255 символов
    - `nullable` - Может быть пустым (null)

- **`material_id.*`** - Массив идентификаторов материалов
    - `required` - Поле обязательно для заполнения
    - `exists:movement_materials,id` - Значение должно существовать в таблице
      `movement_materials`

- **`quantity.*`** - Массив количеств для списания
    - `required` - Поле обязательно для заполнения
    - `min` - Количество должно быть больше или равно нулю

## Кастомные сообщения об ошибках (метод messages)

```php
public function messages(): array
{
    return [
        'comment.min' => 'Комментарий должен содержать минимум :min символов.',
        'comment.max' => 'Комментарий должен содержать максимум :max символов.',
        'material_id.*.required' => 'Материал обязателен.',
        'material_id.*.exists' => 'Материал не найден.',
        'quantity.*.required' => 'Количество обязательно.',
        'quantity.*.min' => 'Количество должно быть больше нуля.',
    ];
}
```

## Кастомные атрибуты (метод attributes)

В данном классе метод `attributes` не определен.

## Особенности валидации

1. **Некорректная структура правил** - В методе `rules()` определены правила в
   некорректном формате:
    - Правила для `material_id.*` и `quantity.*` определены как ассоциативный
      массив с сообщениями об ошибках вместо массива правил
    - Правильный формат должен быть:
      `'material_id.*' => 'required|exists:movement_materials,id'`

2. **Массивная валидация** - Класс ожидает получение массивов данных для
   массового списания материалов

3. **Проверка существования** - Каждый идентификатор материала проверяется на
   существование в таблице `movement_materials`

4. **Допустимость нулевого количества** - Комментарий в правилах говорит о том,
   что количество должно быть больше или равно нулю, что позволяет списывать
   нулевое количество (возможно для документальных целей)

5. **Несоответствие сообщений** - В методе `messages()` указано сообщение "
   Количество должно быть больше нуля", что противоречит комментарию в
   правилах "Количество должно быть больше или равно нулю"

## Используемые в контроллерах

Данный Form Request используется в контроллере, ответственном за операции
списания материалов в цехе:

```php
// Пример использования в контроллере
public function saveWriteOff(SaveWriteOffMovementMaterialToWorkshopRequest $request)
{
    $validated = $request->validated();
    // Логика списания материалов
}
```

Пример валидных данных:

```json
{
    "comment": "Списание бракованных материалов",
    "material_id": ["123", "456", "789"],
    "quantity": ["5", "10", "0"]
}
```

## Заметки о реализации

В коде класса присутствуют ошибки в определении правил валидации, которые могут
вызывать проблемы при работе. Рекомендуется исправить структуру правил для
корректной работы валидации:

```php
// Правильная структура правил
public function rules(): array
{
    return [
        'comment' => 'string|min:2|max:255|nullable',
        'material_id.*' => 'required|exists:movement_materials,id',
        'quantity.*' => 'required|numeric|min:0',
    ];
}
```
