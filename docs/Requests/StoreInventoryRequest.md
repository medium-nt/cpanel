# StoreInventoryRequest

## Назначение класса валидации

Класс `StoreInventoryRequest` предназначен для валидации запросов на создание
инвентаризации. Этот класс используется для запуска процесса инвентаризации
товаров на складе с возможностью выбора конкретной полки или полной
инвентаризации.

## Правила авторизации (метод authorize)

```php
public function authorize(): bool
{
    return true;
}
```

- Все авторизованные пользователи имеют право выполнять данный запрос
- Дополнительные проверки авторизации не требуются

## Правила валидации (метод rules)

```php
public function rules(): array
{
    return [
        'comment' => 'nullable|string|min:5|max:255',
        'inventory_shelf' => [
            'required',
            Rule::in(array_merge(['all'], Shelf::pluck('id')->toArray())),
        ],
    ];
}
```

### Поля валидации:

- **`comment`** - Комментарий к инвентаризации
    - `nullable` - Поле может быть пустым (null)
    - `string` - Должно быть строкой
    - `min:5` - Минимальная длина - 5 символов
    - `max:255` - Максимальная длина - 255 символов

- **`inventory_shelf`** - Выбор полки для инвентаризации
    - `required` - Поле обязательно для заполнения
    - `Rule::in(array_merge(['all'], Shelf::pluck('id')->toArray()))` - Значение
      должно входить в список разрешенных, где:
        - `'all'` - специальное значение для инвентаризации всех полок
        - `Shelf::pluck('id')->toArray()` - массив ID всех существующих полок из
          таблицы `shelves`

## Кастомные сообщения об ошибках (метод messages)

```php
public function messages(): array
{
    return [
        'comment.string' => 'Комментарий должен быть строкой',
        'comment.min' => 'Комментарий должен быть не менее :min символов',
        'comment.max' => 'Комментарий должен быть не более :max символов',
        'inventory_shelf.required' => 'Тип инвентаризации обязателен',
        'inventory_shelf.in' => 'Неверно выбран тип инвентаризации',
    ];
}
```

## Кастомные атрибуты (метод attributes)

В данном классе метод `attributes` не определен.

## Особенности валидации

1. **Динамическая валидация** - Поле `inventory_shelf` использует динамический
   список допустимых значений, формируемый на основе существующих полок в базе
   данных

2. **Гибкая инвентаризация** - Поддерживаются два режима инвентаризации:
    - Полная инвентаризация (значение `'all'`)
    - Частичная инвентаризация по конкретной полке (значение ID полки)

3. **Использование модели Shelf** - Класс напрямую обращается к модели `Shelf`
   для получения списка допустимых ID полок

4. **Правило Rule::in** - Используется продвинутая валидация Laravel для
   проверки вхождения значения в разрешенный список

5. **Минимальная длина комментария** - Требует минимум 5 символов, что
   обеспечивает содержательность комментария

## Используемые в контроллерах

Данный Form Request используется в контроллере инвентаризации для создания новых
процессов инвентаризации:

```php
// Пример использования в контроллере
public function store(StoreInventoryRequest $request)
{
    $validated = $request->validated();

    // Создание инвентаризации
    $inventoryCheck = new InventoryCheck();
    $inventoryCheck->comment = $validated['comment'];
    $inventoryCheck->shelf_id = $validated['inventory_shelf'];
    $inventoryCheck->save();

    // Запуск процесса инвентаризации
    // ...
}
```

Пример валидных данных:

```json
{
    "comment": "Ежемесячная инвентаризация декабрь 2025",
    "inventory_shelf": "all"
}
```

Или для конкретной полки:

```json
{
    "comment": "Проверка полки с проблемными материалами",
    "inventory_shelf": "5"
}
```

## Преимущества реализации

1. **Текущая актуальность** - Список полок всегда актуален, так как
   запрашивается напрямую из базы данных
2. **Информативность** - Минимальная длина комментария гарантирует наличие
   осмысленного описания
3. **Гибкость** - Поддержка как полной, так и частичной инвентаризации
4. **Ошибкоустойчивость** - Правило `Rule::in` предотвращает указание
   несуществующих полок
