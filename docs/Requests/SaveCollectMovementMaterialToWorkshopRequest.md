# SaveCollectMovementMaterialToWorkshopRequest

## Назначение класса валидации

Класс `SaveCollectMovementMaterialToWorkshopRequest` предназначен для валидации
запросов на сборку материалов в цехе. Этот класс используется для фиксации сбора
уже обработанных материалов из цеха.

## Правила авторизации (метод authorize)

```php
public function authorize(): bool
{
    return true;
}
```

- Все авторизованные пользователи имеют право выполнять данный запрос
- Дополнительные проверки авторизации не требуются

## Правила валидации (метод rules)

```php
public function rules(): array
{
    return [
        'material_id.*.required' => 'Материал обязателен.',
        'material_id.*.exists:movement_materials,id' => 'Материал не найден.',
        'quantity.*.required' => 'Количество обязательно.',
        'quantity.*.min' => 'Количество должно быть больше или равно нулю.',
    ];
}
```

### Поля валидации:

- **`material_id.*`** - Массив идентификаторов материалов
    - Правило определено некорректно - содержит сообщение об ошибке вместо
      правил валидации
    - Корректные правила должны быть: `required|exists:movement_materials,id`

- **`quantity.*`** - Массив количеств собираемых материалов
    - Правило определено некорректно - содержит сообщение об ошибке вместо
      правил валидации
    - Корректные правила должны быть: `required|numeric|min:0`

## Кастомные сообщения об ошибках (метод messages)

```php
public function messages(): array
{
    return [
        'material_id.*.required' => 'Материал обязателен.',
        'material_id.*.exists' => 'Материал не найден.',
        'quantity.*.required' => 'Количество обязательно.',
        'quantity.*.min' => 'Количество должно быть больше нуля.',
    ];
}
```

## Кастомные атрибуты (метод attributes)

В данном классе метод `attributes` не определен.

## Особенности валидации

1. **Некорректная структура правил** - В методе `rules()` правила определены в
   неверном формате:
    - Вместо правил валидации указаны сообщения об ошибках
    - Правильный формат для `material_id.*`:
      `'material_id.*' => 'required|exists:movement_materials,id'`

2. **Отсутствие комментария** - В отличие от других классов для работы с
   материалами, здесь отсутствует поле для комментария

3. **Массивная валидация** - Класс ожидает получение массивов данных для
   массового сбора материалов

4. **Проверка существования** - Каждый идентификатор материала проверяется на
   существование в таблице `movement_materials`

5. **Допустимость нулевого количества** - Комментарий в правилах говорит о том,
   что количество должно быть больше или равно нулю, что позволяет собирать
   нулевое количество (возможно для документальных целей)

6. **Несоответствие сообщений** - В методе `messages()` указано сообщение "
   Количество должно быть больше нуля", что противоречит комментарию в правилах

## Используемые в контроллерах

Данный Form Request используется в контроллере, ответственном за операции сбора
готовых материалов из цеха:

```php
// Пример использования в контроллере
public function saveCollect(SaveCollectMovementMaterialToWorkshopRequest $request)
{
    $validated = $request->validated();
    // Логика сбора материалов из цеха
}
```

Пример валидных данных:

```json
{
    "material_id": ["456", "789"],
    "quantity": ["50", "30"]
}
```

## Заметки о реализации

В коде класса присутствуют критические ошибки в определении правил валидации,
которые предотвращают корректную работу валидации. Рекомендуется исправить
структуру правил:

```php
// Правильная структура правил
public function rules(): array
{
    return [
        'material_id.*' => 'required|exists:movement_materials,id',
        'quantity.*' => 'required|numeric|min:0',
    ];
}
```

## Контекст использования

Класс используется для фиксации завершения производственного цикла - когда
материалы были обработаны в цехе и теперь готовы для перемещения на склад или
дальнейшей обработки. Это заключительный этап в процессе перемещения материалов
через производственный цех.

Отличие от других Request классов для работы с материалами:

- Отсутствует поле `comment` - процесс сбора не требует дополнительных
  комментариев
- Фокус на операциях "сбора" готовой продукции, а не перемещения сырья
- Вероятно используется в связке с другими операциями по перемещению материалов
